<% javascript_tag do%>
function flip_dob_field(chk_box){
	if (chk_box.checked){
		$('dod_label').setStyle("display:inline");
		$('dod_text').setStyle("display:inline");	
	}else{
		$('dod_label').setStyle("display:none");	
		$('dod_text').setStyle("display:none");	
		//also clear the form elements
		$('profile_date_of_death_1i').selectedIndex = 0;
		$('profile_date_of_death_2i').selectedIndex = 0;
		$('profile_date_of_death_3i').selectedIndex = 0;
	}
}
function flip_div_field (chk_box){
	if (chk_box.checked){
		$('end_date_label').setStyle("display:inline");	
		$('end_date_form').setStyle("display:inline");	
	}else{
		$('end_date_label').setStyle("display:none");	
		$('end_date_form').setStyle("display:none");	
		//also clear the form elements
		$('relationship_end_date_1i').selectedIndex = 0;
		$('relationship_end_date_2i').selectedIndex = 0;
		$('relationship_end_date_3i').selectedIndex = 0;
	}
}
function submit_add_form(profile_id){
	$('profile_id').value=profile_id;
	$('add_form').request();
}
<% end %>

<fieldset>
	<legend>Edit Relationships</legend>
	<table width="100%">
		<tr>
			<td>
				<fieldset>
					<legend>Parents</legend>
					<table>
						<tr>
							<td >Father:</td>
							<td>
								<table id="father">								
									<tr id="add_father" style="<%= 'display:none' if @profile.father!=nil%>"><td>										
										Add Father by <%=link_to_remote_lightbox( "Creating a Profile", {:url=>{:controller=>"profile", :action=>"new_relationship"}, :with=>"'ref_id='+#{@profile.id}+'&role_id='+#{Role.find_by_name("Father").id}"}) %>
										or Searching for an Existing Profile: 										
										<%= auto_complete_text_field :profile, :name, {:index=>0, :size=>15, :value=>""}, {:select=>"show_this", :with=>"'profile_name='+element.value+'&project_id='+#{@profile.project.id}", :after_update_element=>"function(e,v){$('role_id').value = #{Role.find_by_name("Father").id}}"}%>									
									</td></tr>
									<% if @profile.father!=nil%>
										<%= render :partial=>"relationship", :locals=>{:profile=>@profile.father, :add_link_id=>"add_father", :role=>"Father", :rel=>@profile.father.relationships.find_by_family_member_id(@profile.id)}%>
									<% end %>								
								</table>								
							</td>
						</tr>
						<tr>
							<td >Mother:</td>
							<td>
								<table id="mother">
									<tr id="add_mother" style="<%= 'display:none' if @profile.mother!=nil%>"><td>										
										Add Mother by <%=link_to_remote_lightbox( "Creating a Profile", {:url=>{:controller=>"profile", :action=>"new_relationship"}, :with=>"'ref_id='+#{@profile.id}+'&role_id='+#{Role.find_by_name("Mother").id}"}) %>
										or Searching for an Existing Profile: 										
										<%= auto_complete_text_field :profile, :name, {:index=>1, :size=>15, :value=>""}, {:select=>"show_this", :with=>"'profile_name='+element.value+'&project_id='+#{@profile.project.id}", :after_update_element=>"function(e,v){$('role_id').value = #{Role.find_by_name("Mother").id}}"}%>
									</td></tr>
									<% if @profile.mother!=nil%>
										<%= render :partial=>"relationship", :locals=>{:profile=>@profile.mother, :add_link_id=>"add_mother", :role=>"Mother", :rel=>@profile.mother.relationships.find_by_family_member_id(@profile.id)}%>
									<% end %>
								</table>
							</td>
						</tr>
					</table>
				</fieldset>
			</td>
		</tr>
		<tr>
			<td>
				<fieldset>
					<legend>Spouse</legend>
					<table id="spouses">
					<tr><td>						
						Add Spouse by <%=link_to_remote_lightbox( "Creating a Profile", {:url=>{:controller=>"profile", :action=>"new_relationship"}, :with=>"'ref_id='+#{@profile.id}+'&role_id='+#{Role.find_by_name("Spouse").id}"}) %>
						or Searching for an Existing Profile: 
					</td></tr>	
					<tr><td>
					<% form_tag({:action=>"create_relationship"}, {:id=>"add_form"})do -%>
						<%=hidden_field_tag "profile_id", nil%>
						<%=hidden_field_tag "ref_id", @profile.id%>
						<%=hidden_field_tag "role_id", nil%>
					<table style="padding:5px; border:1px dotted #888a85">
						<tr>
							<td><%= label_tag "relationship_start_date", "Marriage Date"%></td>
							<td><%= date_select :relationship, :start_date, :start_year => Time.new.year, :end_year=>0, :order=>[:month, :day, :year],  :prompt => { :day => 'Day', :month => 'Month', :year => 'Year' }%></td>
							<td>Divorced? <%= check_box(:relationship, :divorced, { :onchange=>"flip_div_field(this)"}, true, false)%></td>
						</tr>
						<tr>
							<td><%= label_tag "relationshi_end_date", "Divorce Date", {:style=>"display:none;", :id=>"end_date_label"}%></td>
							<td><span id="end_date_form" style="display:none"><%= date_select :relationship, :end_date, {:start_year => 0, :order=>[:month, :day, :year],  :prompt => { :day => 'Day', :month => 'Month', :year => 'Year' }}%></span></td>
							<td></td>
						</tr>
						<tr>	
							<td>Name:</td>								
							<td><%= auto_complete_text_field :profile, :name, {:index=>2, :size=>15, :value=>""}, {:select=>"show_this", :with=>"'profile_name='+element.value+'&project_id='+#{@profile.project.id}", :after_update_element=>"function(e,v){$('role_id').value = #{Role.find_by_name("Spouse").id}}"}%></td>
							<td></td>
						</tr>	
					</table>
					<% end %>
					</td></tr>					
					<% if @profile.marriages %>
						<% @profile.marriages.each do |marriage|%>
							<%= render :partial=>"relationship", :locals=>{:profile=>marriage.family_member, :add_link_id=>nil, :role=>"Spouse", :rel=>marriage}%>					
						<% end %>
					<% end %>
					</table>
				</fieldset>
			</td>
		</tr>
		<tr>
			<td>
				<fieldset>
					<legend>Children</legend>
					<table id="children">
						<tr id="add_child" ><td>
							Add Child by <%=link_to_remote_lightbox( "Creating a Profile", {:url=>{:controller=>"profile", :action=>"new_relationship"}, :with=>"'ref_id='+#{@profile.id}+'&role_id='+#{Role.find_by_name("Child").id}"}) %>
							or Searching for an Existing Profile: 										
							<%= auto_complete_text_field :profile, :name, {:index=>3, :size=>15, :value=>""}, {:select=>"show_this", :with=>"'profile_name='+element.value+'&project_id='+#{@profile.project.id}", :after_update_element=>"function(e,v){$('role_id').value = #{Role.find_by_name("Child").id}}"}%>
						</td></tr>						
						<% if @profile.children %>
							<% @profile.children.each do |child|%>
								<%= render :partial=>"relationship", :locals=>{:profile=>child, :add_link_id=>nil, :role=>"Child", :rel=>child.relationships.find_by_family_member_id(@profile.id)}%>
							<% end %>
						<% end %>
					</table>
				</fieldset>
			</td>
		</tr>
		<tr>
			<td colspan="2" align="right" style="border-top:1px dotted #d3d7cf;"> <%=link_to "Back", :back %></td>
		</tr>
	</table>
</fieldset>